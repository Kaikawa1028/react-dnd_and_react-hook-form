{"ast":null,"code":"import _extends from \"@babel/runtime-corejs2/helpers/esm/extends\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/project/react-dnd_and_react-hook-form/pages/index.tsx\";\nvar __jsx = React.createElement;\nimport React from \"react\";\nimport { DndProvider, useDrag, useDrop } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\nimport { FormProvider, useFieldArray, useForm, useFormContext } from \"react-hook-form\";\n\nvar Items = function Items(_ref) {\n  var movie = _ref.movie,\n      position = _ref.position,\n      moveCard = _ref.moveCard;\n  // FormProviderによってここで受け取りが簡単に\n  var methods = useFormContext(); //useDropとuseDragを使用し、dropとdragを得る。\n  //最低限並び替えできるのが以下の実装\n\n  var _useDrop = useDrop({\n    accept: \"CARD\",\n    //useDragのitemフィールドで指定した項目が参照できる\n    hover: function hover(item) {\n      var dragIndex = item.index; //drag中のインデックス\n\n      var hoverIndex = position; //hover対象のインデックス\n\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n\n      moveCard(dragIndex, hoverIndex);\n      item.index = hoverIndex;\n    }\n  }),\n      _useDrop2 = _slicedToArray(_useDrop, 2),\n      drop = _useDrop2[1];\n\n  var _useDrag = useDrag(function () {\n    return {\n      type: \"CARD\",\n      item: {\n        index: position,\n        id: movie.id,\n        type: \"CARD\"\n      },\n      collect: function collect(monitor) {\n        return {\n          isDragging: monitor.isDragging()\n        };\n      }\n    };\n  }, [position]),\n      _useDrag2 = _slicedToArray(_useDrag, 3),\n      isDragging = _useDrag2[0].isDragging,\n      drag = _useDrag2[1],\n      preview = _useDrag2[2];\n\n  return __jsx(\"div\", {\n    //dropとpreviewを結びつけることでpreview対象に\n    // previewだとdragはできない\n    ref: function ref(node) {\n      return preview(drop(node));\n    },\n    style: {\n      opacity: isDragging ? 0.5 : 1,\n      fontSize: 25,\n      cursor: \"pointer\",\n      display: \"flex\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57\n    },\n    __self: this\n  }, __jsx(\"input\", _extends({}, methods.register(\"items[\".concat(position, \"].title\")), {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68\n    },\n    __self: this\n  })), __jsx(\"input\", _extends({}, methods.register(\"items[\".concat(position, \"].description\")), {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69\n    },\n    __self: this\n  })), __jsx(\"button\", {\n    ref: function ref(node) {\n      return drag(drop(node));\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73\n    },\n    __self: this\n  }, \"XX\"));\n};\n\nexport default (function () {\n  // formの定義\n  var methods = useForm({\n    defaultValues: {\n      test: \"test\",\n      items: [{\n        id: \"1xx\",\n        title: \"Movie barato\",\n        description: \"Lorem ipsum 1\"\n      }, {\n        id: \"2bb\",\n        title: \"Movie médio\",\n        description: \"Lorem ipsum 2\"\n      }, {\n        id: \"3ee\",\n        title: \"Movie caro\",\n        description: \"Lorem ipsum 3\"\n      }]\n    }\n  }); // 配列部分の管理宣言\n  // controlが上記formであることを紐付けてる\n\n  var _useFieldArray = useFieldArray({\n    control: methods.control,\n    name: \"items\"\n  }),\n      fields = _useFieldArray.fields,\n      move = _useFieldArray.move;\n\n  var onSubmit = function onSubmit(data) {\n    return console.log(data);\n  };\n\n  return (// FormProviderによって子コンポーネントにmethodsを渡しやすくしてる\n    __jsx(FormProvider, _extends({}, methods, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102\n      },\n      __self: this\n    }), __jsx(\"form\", {\n      onSubmit: methods.handleSubmit(onSubmit),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103\n      },\n      __self: this\n    }, __jsx(\"input\", _extends({}, methods.register(\"test\"), {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105\n      },\n      __self: this\n    })), __jsx(\"hr\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106\n      },\n      __self: this\n    }), __jsx(DndProvider, {\n      backend: HTML5Backend,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112\n      },\n      __self: this\n    }, fields.map(function (field, index) {\n      return __jsx(Items, {\n        key: field.id,\n        movie: field,\n        position: index,\n        moveCard: move,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 114\n        },\n        __self: this\n      });\n    })), __jsx(\"button\", {\n      type: \"submit\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122\n      },\n      __self: this\n    }, \"PUSH\")))\n  );\n});","map":{"version":3,"sources":["/project/react-dnd_and_react-hook-form/pages/index.tsx"],"names":["React","DndProvider","useDrag","useDrop","HTML5Backend","FormProvider","useFieldArray","useForm","useFormContext","Items","movie","position","moveCard","methods","accept","hover","item","dragIndex","index","hoverIndex","drop","type","id","collect","monitor","isDragging","drag","preview","node","opacity","fontSize","cursor","display","register","defaultValues","test","items","title","description","control","name","fields","move","onSubmit","data","console","log","handleSubmit","map","field"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport { DndProvider, useDrag, useDrop } from \"react-dnd\";\nimport { HTML5Backend } from \"react-dnd-html5-backend\";\nimport {\n  FormProvider,\n  useFieldArray,\n  useForm,\n  useFormContext\n} from \"react-hook-form\";\n\ntype MoviesType = {\n  movie: {\n    title: string;\n    description: string;\n    id: string;\n  };\n  position: number;\n  moveCard: (from: number, to: number) => void;\n};\n\nconst Items = ({ movie, position, moveCard }: MoviesType) => {\n  // FormProviderによってここで受け取りが簡単に\n  const methods = useFormContext();\n\n  //useDropとuseDragを使用し、dropとdragを得る。\n  //最低限並び替えできるのが以下の実装\n  const [, drop] = useDrop({\n    accept: \"CARD\",\n\n    //useDragのitemフィールドで指定した項目が参照できる\n    hover: (item: Record<string, any>) => {\n      const dragIndex = item.index; //drag中のインデックス\n      const hoverIndex = position; //hover対象のインデックス\n\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      moveCard(dragIndex, hoverIndex);\n      item.index = hoverIndex;\n    }\n  });\n\n  const [{ isDragging }, drag, preview] = useDrag(\n    () => ({\n      type: \"CARD\",\n      item: { index: position, id: movie.id, type: \"CARD\" },\n      collect: (monitor) => {\n        return {\n          isDragging: monitor.isDragging()\n        };\n      }\n    }),\n    [position]\n  );\n\n  return (\n    <div\n      //dropとpreviewを結びつけることでpreview対象に\n      // previewだとdragはできない\n      ref={(node) => preview(drop(node))}\n      style={{\n        opacity: isDragging ? 0.5 : 1,\n        fontSize: 25,\n        cursor: \"pointer\",\n        display: \"flex\"\n      }}\n    >\n      <input {...methods.register(`items[${position}].title`)} />\n      <input {...methods.register(`items[${position}].description`)} />\n      {/*\n          //dropとdragを結びつけることでdrag対象に\n        */}\n      <button ref={(node) => drag(drop(node))}>XX</button>\n    </div>\n  );\n};\n\nexport default () => {\n  // formの定義\n  const methods = useForm({\n    defaultValues: {\n      test: \"test\",\n      items: [\n        { id: \"1xx\", title: \"Movie barato\", description: \"Lorem ipsum 1\" },\n        { id: \"2bb\", title: \"Movie médio\", description: \"Lorem ipsum 2\" },\n        { id: \"3ee\", title: \"Movie caro\", description: \"Lorem ipsum 3\" }\n      ]\n    }\n  });\n\n  // 配列部分の管理宣言\n  // controlが上記formであることを紐付けてる\n  const { fields, move } = useFieldArray({\n    control: methods.control,\n    name: \"items\"\n  });\n\n  const onSubmit = (data: any) => console.log(data);\n\n  return (\n    // FormProviderによって子コンポーネントにmethodsを渡しやすくしてる\n    <FormProvider {...methods}>\n      <form onSubmit={methods.handleSubmit(onSubmit)}>\n        {/*  registerでinputと紐付け */}\n        <input {...methods.register(\"test\")} />\n        <hr />\n        {/*\n          並び替え対象部分をDndProviderにする\n          タッチデバイスでないときはHTML5Backendを指定\n          @see https://qiita.com/hiyamamoto/items/d83cf4ccfcfa886a0ba8\n        */}\n        <DndProvider backend={HTML5Backend}>\n          {fields.map((field, index) => (\n            <Items\n              key={field.id}\n              movie={field}\n              position={index}\n              moveCard={move}\n            />\n          ))}\n        </DndProvider>\n        <button type=\"submit\">PUSH</button>\n      </form>\n    </FormProvider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}